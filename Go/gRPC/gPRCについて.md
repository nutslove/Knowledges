## Protocol Buffers（protobuf）
- **スキーマ言語**であり、gRPCのデータフォーマットとして使われる。
- 様々なプログラミング言語に対応
- **バイナリ形式**でデータのサイズが小さく、通信コストとストレージコストを削減できる。
- データ構造(スキーマ)は **`.proto`** ファイルで定義され、このスキーマを基にしてデータが(バイナリ形式に)**シリアライズ**(およびデシリアライズ)される。これにより、データの一貫性と明確な構造が保たれる。
  - *シリアライズ(Serialization)*
    - データ構造やオブジェクト状態を、保存や送信に適したフォーマット（通常はバイト列）に変換するプロセス。このプロセスは、メモリ内のデータ構造をファイル、データベース、またはネットワークを通じて送信できる形式に変換するために使われる
    - シリアライズの例
      - オブジェクトの状態をJSONやXMLのようなテキストベースのフォーマットに変換
      - Protocol BuffersやApache Avroのようなバイナリフォーマットを使用して、データをよりコンパクトにする
  - *デシリアライズ(Deserialization)*
    - デシリアライズは、シリアライズの逆プロセスであり、保存されたデータやネットワークを介して受信したデータを、元のデータ構造やオブジェクトに再構築するプロセス。これにより、データを使ってプログラム内で操作が可能になる。
    - デシリアライズの例
      - JSONやXMLファイルを読み込み、それをプログラム内のオブジェクトに変換
      - バイナリデータを受信し、それをメモリ内のデータ構造に再構築
- **型**があり、**型安全性**が確保され、エラーの可能性が減少
- Jsonに変換することも可能
- `.proto`ファイルの1行目には`syntax = "proto3";`とprotobufのバージョンを指定
  - 記述しない場合はproto2バージョンが使用される
  - proto2とproto3は互換性がないので注意

#### message
- データ構造を定義するための基本的な単位
- 一連のフィールドを持ち、それぞれのフィールドは特定の型（基本型や他のmessage型）を持つ
- Messageはバイナリ形式にシリアライズされ、簡単にデータ転送や保存ができる。  
  受信側ではデシリアライズされ、元のデータ構造に戻される。
- **型**、**フィールドの名前**、**識別番号(タグ番号)** を指定
- **protobufでは各フィールドは**フィールド名ではなく、**タグ番号によって識別される**
  - タグ番号は一意である必要がある
  - 19000 ~ 19999はProtobufによって予約されていて使用不可
  - 連番にする必要はない
- messageの例
  ~~~
  syntax = "proto3"; --> 末尾に";"が必要

  message Person {
    string name = 1; --> 1は値の代入ではなくタグ
    int32 id = 2;
    string email = 3;

    enum PhoneType {
      MOBILE = 0;
      HOME = 1;
      WORK = 2;
    }

    message PhoneNumber {
      string number = 1;
      PhoneType type = 2;
    }

    repeated PhoneNumber phones = 4;
  }
  ~~~
- **`enum`**
  - 列挙型
    - 列挙した値のいずれかであることを要求する型
    - 特定のフィールドで許可される値の範囲を制限
    - 固定された一連の定数値を含む特別なデータ型
  - 型の定義は不要
  - すべて大文字で定義
  - messageとは異なり、数字はタグ番号ではなく、実際の値(定数)
  - 名前で識別される
  - **必ず最初にデフォルト値の`0`を定義する必要がある**
    - `0`以外の`1`などの特定の値をスキップすることは可能
    - `0`は慣例的に`UNKNOWN`にすることが多い