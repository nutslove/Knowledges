- https://inuplace.tistory.com/602
- https://losskatsu.github.io/it-infra/django-inspectdb/#1-db-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%9E%A5%EA%B3%A0%EB%A1%9C-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0

## models.pyを修正した後にDBに反映する方法
- Djangoをコンテナで動かしてる場合はDjangoコンテナに入る
- `python3 manage.py makemigrations <アプリ名>`を実行
  - e.g. `python3 manage.py makemigrations privilege`
- `python3 manage.py migrate <アプリ名>`を実行
  - e.g. `python3 manage.py migrate privilege`


### DjangoのModelとDBデータ型のマッピング
- https://qiita.com/okoppe8/items/13ad7b7d52fd6a3fd3fc

### Modelで`primary_key=True`を指定しない場合、Djangoが自動的に`id`というPrimary Keyを作成する
- https://docs.djangoproject.com/en/4.2/topics/db/models/#automatic-primary-key-fields
- 以下のように`primary_key=True`のないModelで作成した時、作成されるDBテーブル例
  - Django側(models.py)
    ~~~python
    from django.db import models

    # Create your models here.
    class Userprivilegestate(models.Model):
      userid = models.CharField(max_length=30, help_text='ユーザID')
      combinationid = models.ForeignKey(Dbuserpassword, on_delete=models.CASCADE)
      endtimestamp = models.DateTimeField(help_text='特権利用終了日時')

      class Meta:
        constraints = [
            models.UniqueConstraint(fields=['userid', 'combinationid'], name='unique_user')
        ]
    ~~~
  - DB側
    ~~~
    postgres=> \d privilege_userprivilegestate
                              Table "public.privilege_userprivilegestate"
      Column      |           Type           | Collation | Nullable |             Default
    ------------------+--------------------------+-----------+----------+----------------------------------
    id               | bigint                   |           | not null | generated by default as identity
    userid           | character varying(30)    |           | not null |
    endtimestamp     | timestamp with time zone |           | not null |
    combinationid_id | character varying(30)    |           | not null |
    Indexes:
        "privilege_userprivilegestate_pkey" PRIMARY KEY, btree (id)
        "unique_user" UNIQUE CONSTRAINT, btree (userid, combinationid_id)
        "privilege_userprivilegestate_combinationid_id_d9d618ef" btree (combinationid_id)
        "privilege_userprivilegestate_combinationid_id_d9d618ef_like" btree (combinationid_id varchar_pattern_ops)
    Foreign-key constraints:
        "privilege_userprivil_combinationid_id_d9d618ef_fk_privilege" FOREIGN KEY (combinationid_id) REFERENCES privilege_dbuserpassword(combinationid) DEFERRABLE INITIALLY DEFERRED
    ~~~

### Djangoには復号主キー機能はないらしい
- https://zenn.dev/shimakaze_soft/scraps/22dcea1acd133a
- その代わりに、複合ユニーク制約の機能を使う