- VPC CNIはUnderlay Networkを使用
## VPC CNIの特徴
- 各Podに対して、VPC内のセカンダリIPアドレスが直接割り当てられる。
- PodはVPC内で他のリソースと直接通信できる。
- PodはVPCのルーティングテーブルに従ってトラフィックをルーティングする。
## VPC CNIプラグインの動作の流れ
1. ワーカーノードごとにElastic Network Interface (ENI) を割り当てます。各ENIには、VPC内のセカンダリIPアドレスの範囲が割り当てられる。
2. 新しいPodが作成されると、VPC CNIプラグインはそのPodに対して、割り当て済みのENIからセカンダリIPアドレスを割り当てる。つまり、PodごとにENIを割り当てるのではなく、ENIに割り当てられたセカンダリIPアドレスの中からPodにIPアドレスを割り当てる。
3. Podが削除されると、割り当てられていたセカンダリIPアドレスが解放され、他のPodで再利用可能になる。
4. 割り当て可能なセカンダリIPアドレスが不足してきた場合、VPC CNIプラグインは自動的に新しいENIをワーカーノードに割り当て、セカンダリIPアドレスのプールを拡張する。
#### 1つのENIに割り当てることができるセカンダリIPの数
- ENIに割り当てることができるプライマリIPアドレスは1つだけだが、**追加のセカンダリIPアドレスは複数割り当てることが可能**。
- 1つのENIに割り当て可能なセカンダリIPアドレス数は、ENIが属するインスタンスのタイプによって決まる(異なる)。